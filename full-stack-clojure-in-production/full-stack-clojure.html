<!DOCTYPE html>
<html>
  <head>
    <title>Full stack Clojure in production</title>
    <meta charset="utf-8">
    <style>
      
    </style>
  </head>
  <body>
    <textarea id="source">

class: center, middle

## Full stack Clojure in production

Андрей Бутов

демо-приложение: <a href="http://tech-radar.github.io" target="_blank">http://tech-radar.github.io</a> 

исходный код проекта: [https://github.com/abtv/tech-radar](https://github.com/abtv/tech-radar)

---

### Основные области применения для Clojure:
1. data processing
2. веб-приложения
3. мобильные приложения*

---

### Почему я выбрал full stack Clojure:
1. быстрая обратная связь (component, figwheel)
2. подход libraries over frameworks (Rum, DataScript, Reagent, Om*)
3. если чего-то нет для clj/cljs, то можно использовать библиотеки Java (Lucene, OpenNLP) и JavaScript (React, d3). см. cljsjs.github.io
4. расширяемость языка (код = данные): honeysql, datalog, core.async, core.logic, core.typed
5. хорошая поддержка параллелизма, асинхронного выполнения кода; неизменяемые данные (ядро языка, core.async, claypoole*)

---

### JavaScript vs Clojure(Script)

```javascript
// Сравнение по ссылке
const a = [1, 2, 3];
const b = [1, 2, 3];
a === b // false
```

```clojure
;; Сравнение по значению
(def a [1 2 3])
(def b [1 2 3])
(= a b) ;; true
```

```javascript
// false
false
0
''
null
undefined
NaN
// все остальное true
```

```clojurescript
;; false
nil
false
;; все остальное true
```

---

### JavaScript vs Clojure(Script)

```javascript
const person = {
  fname: 'John',
  mname: 'J',
  lname: 'Doe'
}

const { fname, lname } = person;
...

const color = [255, 255, 100, 0.7];

const [r, , b, a] = color;
...
```

```clojurescript
(def person {:fname "John"
             :mname "J"
             :lname "Doe"})

(let [{:keys [fname lname]} person]
  ...)

(def color [255 255 100 0.7])

(let [[r _ b a] color]
  ...)
```

---

### JavaScript vs Clojure(Script)

```javascript
1 + "2" //"12"
```

```clojure
(+ 1 "2") ;error
```

```javascript
const obj = { foo: 'bar' };
obj.foo = 'baz';

const arr = [1, 2, 3];
arr.push(4);
```

```clojurescript
(def obj {:foo "bar"})
(assoc obj :foo "baz")
;; создает новую коллекцию, не изменяя оригинал

(def arr [1 2 3])
(conj arr 4)
;; создает новую коллекцию, не изменяя оригинал
```

---

### Communicating sequential processes (core.async)
1. Каналы (очереди)
2. Процессы

![core.async](core.async.png)

---

### Входной и выходной каналы и процесс

```clojure

(defn tweet-classifier [tweet-chan classified-chan]
  (go-loop []
    (when-let [tweet (<! tweet-chan)]
      (let [classified (time-consuming-classification tweet)]
        (>! classified-chan classified)
        (recur)))
```

каждый вызов tweet-classifer создает легковесный процесс

процесс ничего не знает о том откуда приходят данные и куда они уходят

---

### Выбор из альтернатив

```clojure

(defn download
  [file-name c]
  (go (<! (timeout (rand 100)))
      (>! c file-name)))

(go
  (let [c1 (chan)
        c2 (chan)]
    (download "clojure.jpg" c1)
    (download "javascript.jpg" c2)
      (let [[file-name channel] (alts! [c1 c2])]
        (println "Downloaded file: " file-name))))

```

---

### Обработка коллекций

```clojure

;Обрабатываем коллекцию (thread macro)
(->> my-collection
     (map enrich-tweet)
     (filter about-programming?)
     (map :weight)
     (reduce + 0))

;Превращаем очередь в ленивую коллекцию
(defn events-seq [^LinkedBlockingQueue queue]
  (let [x (.take queue)]
    (cons x (events-seq queue)))

;Трансдьюсер позволяет разделить логику обработки коллекции и саму коллекцию
(def tr (comp
          (map enrich-tweet)
          (filter about-programming?)
          (map :weight))

```

---

## Спасибо за внимание

http://webmeetups.net/mgroups/25 - русскоязычный Clojure хэнгаут

https://clojurescript.ru - видеоуроки по ClojureScript для JavaScript разработчиков

https://www.4clojure.com/problems - сборник задач на Clojure

https://github.com/abtv - моя учетная запись на GitHub

    </textarea>
    <script src="remark-latest.min.js">
    </script>
    <script>
      var slideshow = remark.create();
    </script>
  </body>
</html>